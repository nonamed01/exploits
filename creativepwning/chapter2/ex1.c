// Exercice 1
// Build:
//  gcc -Wl,-z,relro,-z,now,--build-id=0xdeadbeefcafebabe -no-pie -fno-stack-protector ex1.c -o ex1
// Goal:    Dump bytes starting at alarm() until reaching execve() and then
// 	    spwan a shell by calling execve("/bin/sh\x00",NULL,NULL);
// Exploit: ex1-exploit.py
#include <stdio.h>
#include <unistd.h>
#include <string.h>

const char *mydata;

int main(int argc, char **argv){

    char data[100];

    // We set an alarm for 10 seconds:
    alarm(10);

    // We zero-out data[]:
    memset(&data,0,100);
    // Now we are giving an easy way of leaking data using puts():
    puts("Feed me with data!");
    // BOF; returning from main is under our control:
    gets(data);

    return 0;
}

__asm__("pop %rdi;ret;");
__asm__("pop %rsi;ret;");
__asm__("pop %rdx;ret;");
