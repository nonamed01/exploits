// Exercice 3
// Build:
//  gcc -Wl,-z,relro,--build-id=0xdeadbeefcafebabe -no-pie -fno-stack-protector ex3.c -O0 -o ex3
// Goal:    Spawm a shell by calling execve("/bin/sh\x00",NULL,NULL);
//          First thing to achieve is to set RAX to 0x3b.
//          There's no syscall gadget.
// Exploit: ex3-exploit.py
#include <stdio.h>
#include <unistd.h>
#include <string.h>

char *mydata = "Hello there!";

int main(int argc, char **argv){

    char data[100];

    // We set the alarm to 10 seconds:
    alarm(10);
    pid_t mypid = getpid();

    // We zero-out data[]:
    memset(&data,0,100);
    // BOF; returning from main is under our control:
    gets(data);
    return 0;
}

__asm__("pop %rdi;ret;");
__asm__("pop %rsi;ret;");
__asm__("pop %rdx;ret;");
