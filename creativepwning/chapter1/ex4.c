// Exercice 4
// Build:
//  gcc -Wl,-z,relro,--build-id=0xdeadbeefcafebabe -no-pie -fno-stack-protector ex4.c -O0 -o ex4
// Goal:    Set RDX to 0x0
// Exploit: ex4-exploit.py
#include <stdio.h>
#include <unistd.h>
#include <string.h>
#include <fcntl.h>

const char *mydata = "Hello there!";

int main(int argc, char **argv){

    char data[100];

    // We set the alarm to 10 seconds:
    alarm(10);

    // We zero-out data[]:
    memset(&data,0,100);
    // Opens /etc/issue for reading:
    int fd = open("/etc/issue",O_RDONLY);
    close(fd);
    pid_t mypid = getpid();
    // BOF; returning from main is under our control:
    gets(data);
    // While returning from main under our control, RDX != 0x0.
    return 0;
}

__asm__("pop %rdi;ret;");
__asm__("pop %rsi;ret;");
